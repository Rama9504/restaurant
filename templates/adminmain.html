<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="\static\menu.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>adminmain</title>
    <style>
      .class1{
        border-radius:5px;
        padding:5px;
      }
      .collapse{
        padding:10px;
        justify-content:space-evenly;
      }
      table{
        border: 1px solid black;
        border-collapse: collapse;
        width:50%;
        margin-top:5%;
        margin-left:5%;
        text-align:center;
      }
      th,td{
        border: 1px solid black;
        border-collapse: collapse;
        margin-top:5%;
        margin-left:5%;
        text-align:center;
      }
      .modal {
        display: none;
        position: fixed;
        bottom: 0;
        left: 50;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        justify-content: center;
        align-items: center;
      }    
      .modal-content {
        background-color: #667292;
        padding: 20px;
        border-radius: 10px;
        max-width: 400px;
        margin: 6% auto;
      }
      .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
      }
    
      .close:hover,
      .close:focus {
          color: black;
          text-decoration: none;
          cursor: pointer;
      }
      .class14{
        color:black;
        text-decoration: none;
      }
      .class279{
        border-color:black;
        border-radius:5px;
        text-align:center;
      }
      .class149{
        text-align:center;
      }
      .class149:hover,
      .class149:focus{
        color:brown;
        text-decoration: none;
        cursor: pointer;
      }
      form {
        background-color: #fff;
        padding: 20px;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        max-width: 500px;
        margin: 0 auto;
      }
      label {
          font-weight: bold;
      }
      input[type="text"],
      input[type="number"],
      input[type="password"],
      input[type="tel"],
      select,
      textarea {
          width: 100%;
          padding: 10px;
          margin: 5px 0;
          border: 1px solid #ccc;
          border-radius: 4px;
          box-sizing: border-box;
      }
      input[type="checkbox"] {
          margin-top: 10px;
      }
      input[type="submit"] {
          background-color: #4CAF50;
          color: white;
          padding: 15px 20px;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          font-size: 16px;
      }
      input[type="submit"]:hover {
          background-color: #45a049;
      }
      .class456{
        background-color: #4CAF50;
        color: white;
        padding: 15px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
      }
      .class456:hover{
        background-color: #45a049;
      }
      .form-container {
        max-width: 500px;
        margin: 0 auto;
        height: 100%; /* Set height according to your preference */
        overflow: auto; /* Add scrolling */
        background-color: #fff;
        padding: 20px;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
      }
      .form-containers {
        max-width: 500px;
        margin: 0 auto;
        margin-top:5%;
        height: 90%; /* Set height according to your preference */
        overflow: auto; /* Add scrolling */
        background-color: #fff;
        padding: 20px;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
      }
      .class87:hover{
        background-color:brown;
      }
    </style>
</head>
<body style="background-color:lightgreen;">
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
      <div class="container-fluid">
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarTogglerDemo01" aria-controls="navbarTogglerDemo01" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarTogglerDemo01">
            <!--<a style="background-color:orange; font-size:15px; height:40px; text-align:center; border-radius:10px; width:130px; color:black;" class="navbar-brand"  href="adminmain/adddishes">Add Dishes</a></button>-->
            <a style="background-color:black; font-size:15px; height:40px; text-align:center; border-radius:10px; width:180px; color:white;" class="navbar-brand" href="{% url 'adminapp:adminmain' %}">Home</a>
            <button style="background-color:orange; font-size:15px; height:43px; text-align:center; border-radius:10px; width:180px; color:black;" class="class279" type="button" id="assign" onclick="adddish()">Add Dishes</button>
            <a style="background-color:orange; font-size:15px; height:40px; text-align:center; border-radius:10px; width:180px; color:black;" class="navbar-brand" href="adminmain/changedish">Changes to Dishes</a></button>
            <a style="background-color:orange; font-size:15px; height:40px; text-align:center; border-radius:10px; width:180px; color:black;" class="navbar-brand" href="adminmain/changedelivery">Changes to D-Boys</a></button>
            <button style="background-color:orange; font-size:15px; height:43px; text-align:center; border-radius:10px; width:180px; color:black;" class="class279" type="button" id="assign" onclick="deliveryboy()">Add Delivery Boy</button>
          </div>
      </div>
    </nav>

    <div style="text-align:center;">
      <h1>Non-Assigned Orders</h1>
      <table style="margin: 0 auto;">
        <thead>
          <tr>
            <th style="width: 25%;">Username</th>
            <th style="width: 25%;">Dishname</th>
            <th style="width: 10%;">Quantity</th>
            <th style="width: 40%;"></th>
          </tr>
        </thead>
        <tbody>
          {% for username, user_orders in orders.items %}
            {% for ord in user_orders %}
              {% if ord.delivery_boy_assigned == False %}
                <tr>
                  {% if forloop.first %}
                    <td rowspan="{{ user_orders|length }}">{{ username }}</td>
                  {% endif %}
                  <td>{{ ord.dish_name }}</td>
                  <td>{{ ord.quantity }}</td>
                  {% if forloop.first %}
                    <td rowspan="{{ user_orders|length }}">
                      <button class="class87" type="button" id="assign" onclick="showDeliveryBoys('{{ username }}')" style="width: 80%; height: 30px;">Assign Delivery boy</button>
                    </td>
                  {% endif %}
                </tr>
              {% endif %}
            {% endfor %}
          {% endfor %}
        </tbody>
      </table>
    </div><br><br><br><br><br>
    
    <div style="text-align:center;">
      <h1>Assigned Orders</h1>
      <table style="margin: 0 auto;">
        <thead>
          <tr>
            <th>Username</th>
            <th>OrderId</th>
            <th>Dishes</th>
            <th>D boy</th>
          </tr>
        </thead>
        <tbody>
          {% for order, deliverymappingss in deliverymappings.items %}
            {% for deliverymapping in deliverymappingss %}
              <tr>
                <td>{{ deliverymapping.users }}</td>
                <td>{{ deliverymapping.ord.id }}</td>
                <td>{{ deliverymapping.ord.dish_name }}</td>
                <td>{{ deliverymapping.d_username }}</td>
              </tr>
            {% endfor %}
          {% endfor %}
        </tbody>
      </table>      
    </div><br><br><br><br><br>

    

    <!-- Your existing HTML structure -->
    <div id="deliveryBoysModal" class="modal" data-assign-url="{% url 'adminapp:assign_deliveryboy' username='username' delivery_boy_username='delivery_boy_username' %}">
      <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span><br>
          {% for del in deliver %}
            <button class="class149" onclick="assignDeliveryBoy('{{del.d_username}}')" {% if not del.availability %}disabled{% endif %}><h6 style="text-align:center">{{ del.d_name }}</h6></button><br>
          {% endfor %}
      </div>
    </div>

    <div id="deliveryboy" class="modal">
      <div class="form-containers">
        <span class="close" onclick="closeModa()">&times;</span><br><br>
        <form method="post" action="{% url 'adminapp:adddeliver' %}">
        {% csrf_token %}
          <label for="email">Email:</label>
          <input type="text" id="email" name="email" required>
          <br><br>
          <label for="d_username">Username:</label>
          <input type="text" id="d_username" name="d_username" required>
          <br><br>
          <label for="d_name">Name:</label>
          <input type="text" id="d_name" name="d_name" required>
          <br><br>
          <label for="d_phone">Phone:</label>
          <input type="tel" id="d_phone" name="d_phone" required>
          <br><br>
          <label for="availability">Availability:</label>
          <input type="checkbox" id="availability" name="availability" checked>
          <br><br>
          <label for="password">Password:</label>
          <input type="password" id="password" name="password" required>
          <br><br>
          <div style="text-align:center">
          <button class="class456" type="submit" onclick="submitForm()">Submit</button>
          </div>
        </form>
      </div>
    </div>
    <div id="adddish" class="modal">
      <div class="form-container">
        <span class="close" onclick="closesModa()">&times;</span><br><br>
        <!--<form method="post" action="{% url 'adminapp:adddishes' %}">
        {% csrf_token %}
        <label for="email">Email:</label>
        <input type="text" id="email" name="email" required>
        <br><br>-->
        <form method="post" action="{% url 'adminapp:adddishes' %}">
        {% csrf_token %}
          <label for="dish_name">Dish Name:</label><br>
          <input type="text" id="dish_name" name="dish_name" required><br><br>
  
          <label for="dish_code">Dish Code:</label><br>
          <input type="text" id="dish_code" name="dish_code" required><br><br>
  
          <label for="price">Price:</label><br>
          <input type="number" id="price" name="price" required><br><br>
  
          <label for="types">Type:</label><br>
          <select id="types" name="types">
              <option value="vegbiryani">Veg Biryani</option>
              <option value="nonvegbiryani">Non-Veg Biryani</option>
              <option value="nonvegstarter">Non-Veg Starter</option>
              <option value="vegstarter">Veg Starter</option>
          </select><br><br>
  
          <label for="availability">Availability:</label>
          <input type="checkbox" id="availability" name="availability" checked><br><br>
  
          <label for="image">Image:</label><br>
          <input type="file" id="image" name="image" accept="image/*"><br><br>
  
          <label for="discount">Discount:</label><br>
          <input type="number" id="discount" name="discount" required><br><br>
  
          <label for="description">Description:</label><br>
          <textarea id="description" name="description" rows="4" cols="50"></textarea><br><br>
  
          <input type="submit" value="Submit">
        </form>
      </div>
    </div>

</body>
<script>
  function deliveryboy(){
    var deliverb=document.getElementById('deliveryboy');
    deliverb.style.display='block';
  }
  function adddish(){
    var deli=document.getElementById('adddish');
    deli.style.display='block';
  }
  setTimeout(function() {
    window.location.href = "/admins/adminmain";
  }, 10000);
  
  function showDeliveryBoys(username) {
    document.getElementById('deliveryBoysModal').setAttribute('data-username', username);
    var deliveryBoysModal = document.getElementById('deliveryBoysModal');
    deliveryBoysModal.style.display = 'block';
  }

  function assignDeliveryBoy(deliveryBoyUsername) {
    var username = document.getElementById('deliveryBoysModal').getAttribute('data-username');
    var assignUrl = document.getElementById('deliveryBoysModal').getAttribute('data-assign-url');
  
    // Replace placeholder values in the URL
    assignUrl = assignUrl.replace('username', encodeURIComponent(username));
    assignUrl = assignUrl.replace('delivery_boy_username', encodeURIComponent(deliveryBoyUsername));

  
    var xhr = new XMLHttpRequest();
    xhr.open('POST', assignUrl, true);
    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    xhr.setRequestHeader('X-CSRFToken', getCookie('csrftoken'));  // Include CSRF token
  
    xhr.onreadystatechange = function () {
      if (xhr.readyState === 4 && xhr.status === 200) {
        // Handle the response if needed
        console.log(xhr.responseText);
      }
    };
  
    xhr.send('username=' + encodeURIComponent(username) + '&deliveryBoyUsername=' + encodeURIComponent(deliveryBoyUsername));
    closeModal();
  }
  

  function getCookie(name) {
    var cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
  }

  function closeModa() {
    var deliveryBoysModa = document.getElementById('deliveryboy');
    deliveryBoysModa.style.display = 'none';
  }
  
  function closesModa() {
    var deliveryBoysModa = document.getElementById('adddish');
    deliveryBoysModa.style.display = 'none';
  }

  function closeModal() {
    var deliveryBoysModal = document.getElementById('deliveryBoysModal');
    deliveryBoysModal.style.display = 'none';
  }

  // Close the modal if the user clicks outside of it
  window.onclick = function(event) {
    var deliveryBoysModal = document.getElementById('deliveryBoysModal');
    if (event.target == deliveryBoysModal) {
      deliveryBoysModal.style.display = 'none';
    }
  }

  function submitForm() {
    var form = document.getElementById('deliveryForm');
    var formData = new FormData(form);
  
    // Use AJAX to submit the form data
    var xhr = new XMLHttpRequest();
    xhr.open('POST', '{% url 'adminapp:adddeliver' %}', true);
    xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
    xhr.onreadystatechange = function () {
      if (xhr.readyState === 4 && xhr.status === 200) {
        // Handle the response if needed
        console.log(xhr.responseText);
      }
    };
    xhr.send(formData);
  }
    

</script>

</html>
